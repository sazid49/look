jQuery(document).ready(function($) {
  var rating_settings_data = RLRR_RATING_SETTINGS_DATA
    ? RLRR_RATING_SETTINGS_DATA.rating_settings_data
    : [];

  if (window.File && window.FileList && window.FileReader) {
    var maxImageSizeLimit = rating_settings_data
      ? parseFloat(rating_settings_data.rlrr_basic_input_attachment_upload_size)
      : 2000000;

    var maxFileCountLimit = rating_settings_data
      ? parseInt(
          rating_settings_data.rlrr_minmaxbutton_attachment_upload_number
        )
      : 5;

    $("#fileUpload").on("change", function(e) {
      if ($("#rlrr-rating-image-field").length != 0) {
        $("#rlrr-rating-image-field").empty();
      }

      var files = e.target.files;
      var maxFileSize = parseFloat(maxImageSizeLimit / (1000 * 1000));
      var maxFileCount = maxFileCountLimit;

      for (var i = 0; i < files.length; i++) {
        var f = files[i];
        var fileSize = f.size;
        var _size = parseFloat(fileSize / (1000 * 1000));

        if (
          maxFileCount == "" ||
          (maxFileCount != "" && files.length <= maxFileCount)
        ) {
          if (
            maxFileSize == "" ||
            (maxFileSize != "" && _size <= maxFileSize)
          ) {
            var fileReader = new FileReader();
            fileReader.onload = function(e) {
              var file = e.target;
              $(
                '<span class="pip">' +
                  '<img class="imageThumb" src="' +
                  e.target.result +
                  '" title="' +
                  file.name +
                  '"/>' +
                  "<br/>" +
                  "</span>"
              ).appendTo("#rlrr-rating-image-field");
            };
            fileReader.readAsDataURL(f);
          } else {
            if ($(".rlrr-file-size-exceed").length == 0) {
              $(
                '<span class="rlrr-file-size-exceed">File Size Exceed [max size : ' +
                  maxFileSize +
                  " MB] </span>"
              ).appendTo("#rlrr-rating-image-field");
            }
            $("#fileUpload").prop("disabled", true);
          }
        } else {
          if ($(".rlrr-file-count-exceed").length == 0) {
            $(
              '<span class="rlrr-file-count-exceed"> File Count Exceed [max file count : ' +
                maxFileCount +
                "] </span>"
            ).appendTo("#rlrr-rating-image-field");
          }
          $("#fileUpload").prop("disabled", true);
        }
      }

      if ($(".remove").length == 0) {
        $(
          '<span class="rlrr-rating-image-remove remove">Remove Photos</span>'
        ).insertAfter("#rlrr-rating-image-field");
        $(".image-container .remove").click(function() {
          $(".remove").remove();
          $("#rlrr-rating-image-field").empty();
          $("#rlrr-rating-image-field .rlrr-file-count-exceed").remove();
          $("#rlrr-rating-image-field .rlrr-file-size-exceed").remove();
          $("#fileUpload").prop("disabled", false);
          $("#fileUpload").val("");
        });
      }
    });
  } else {
    console.log("Your browser doesn't have support to File API");
  }
});
